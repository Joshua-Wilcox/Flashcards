<!DOCTYPE html>
<html>
<head>
    <title>Report Question</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style-index.css') }}">
    <style>
        /* Unique styles for this page only */
        .report-card { max-width: 800px; margin: 20px auto; box-shadow: 0 4px 16px rgba(0,0,0,0.08); border-radius: 12px; }
        .welcome-title { font-size: 2rem; font-weight: 700; color: #0d6efd; margin-bottom: 5px; }
        .welcome-desc { font-size: 1.1rem; color: #555; margin-top: 5px; margin-bottom: 10px; }
        
        /* New unified styling for question boxes */
        .qa-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        
        .correct-answer-section {
            background-color: #f0f9ff;
            border-left: none;
        }
        
        .distractor-section {
            background-color: #f9f9f9;
            border-left: none;
        }
        
        .item-box {
            background-color: #ffffff;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            font-size: 1.05rem;
            border: none;
        }
        
        .question-box {
            background-color: #f8f9fa;
        }
        
        .answer-box {
            background-color: #f0f9ff;
        }
        
        .section-title {
            font-size: 1.4rem;
            margin-bottom: 12px;
            color: #0d6efd;
            font-weight: 600;
        }
        
        .subsection-title {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #212529;
            font-weight: 500;
        }
        
        .navbar-nav .nav-link {
            border-radius: 999px !important;
            padding: 6px 18px !important;
            margin-left: 6px;
        }
        .navbar-nav .nav-link:hover, .navbar-nav .nav-link:focus {
            background: #e2e6ea !important;
            color: #222 !important;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            transform: scale(1.04);
        }
        .guidance-box {
            background-color: #e7f3ff;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 12px;
        }
        .guidance-box ul {
            margin-bottom: 0;
            padding-left: 1.5rem;
        }
        .form-message {
            min-height: 250px !important;
            height: 250px !important;
            margin-bottom: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 2px solid #b8daff;
            background-color: #f8faff;
            padding: 12px;
            font-size: 1.05rem;
            color: #333;
        }
        .form-message:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
            background-color: #fff;
        }
        .form-message::placeholder {
            color: #6c757d;
            opacity: 0.8;
        }
        .form-label-highlighted {
            font-weight: 600;
            color: #0d6efd;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        footer {
            margin-top: auto;
            padding: 10px 0;
        }
        .btn-submit {
            background-color: #0d6efd;
            color: white;
            font-weight: bold;
            border-radius: 8px;
            padding: 10px 20px;
            transition: all 0.2s;
        }
        .btn-submit:hover {
            background-color: #0b5ed7;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .btn-submit:disabled {
            background-color: #8db5f8;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        .textarea-container {
            position: relative;
            margin-bottom: 15px;
        }
        @media (max-width: 900px) {
            .report-card { max-width: 98vw; }
        }
        /* More compact layout */
        .compact-section {
            margin-bottom: 12px;
        }
        .compact-header {
            margin-bottom: 8px;
            font-size: 1.2rem;
            color: #0d6efd;
        }
        .compact-mb {
            margin-bottom: 8px;
        }
        .btn-group-compact {
            display: flex;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="content-wrapper">
        <div class="container mt-4">
            <nav class="navbar navbar-expand-lg navbar-light bg-light mb-3">
                <div class="container-fluid">
                    <span class="navbar-brand">Flashcards</span>
                    <div class="navbar-nav ms-auto">
                        <a class="nav-link" href="{{ url_for('main.index') }}">Back to Flashcards</a>
                    </div>
                </div>
            </nav>
            
            <div class="report-card card p-4">
                <div class="text-center mb-3">
                    <div class="welcome-title">Report a Question</div>
                    <div class="welcome-desc">Please provide details about the issue with this question or answer.</div>
                </div>
                
                <form method="post" autocomplete="off" id="report-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="question_text" value="{{ question }}">
                    <input type="hidden" name="answer_text" value="{{ answer }}">
                    <input type="hidden" name="distractors_json" value="{{ distractors_json }}">
                    
                    <!-- Top submit button -->
                    <div class="d-grid mb-3">
                        <button type="submit" class="btn btn-submit" id="submit-button-top" disabled>Submit Report</button>
                    </div>
                    
                    <div class="guidance-box mb-3">
                        <h5 class="compact-header">Reporting Guidelines</h5>
                        <p class="compact-mb">When reporting, please be specific and include:</p>
                        <ul>
                            <li>What is incorrect about the question or answer</li>
                            <li>If distractors are problematic, mention them by number</li>
                            <li>Provide any corrections or suggestions</li>
                        </ul>
                    </div>
                    
                    <!-- Message textbox right below guidelines -->
                    <div class="mb-3">
                        <label for="message" class="form-label-highlighted">Describe the issue:</label>
                        <textarea class="form-control form-message" id="message" name="message" required 
                              placeholder="Please describe what's wrong with this question, answer, or distractors."></textarea>
                    </div>
                    
                    <div class="row">
                        <!-- Main Question Section -->
                        <div class="col-12">
                            <div class="qa-section correct-answer-section">
                                <h2 class="section-title">Correct Answer</h2>
                                
                                <div class="mb-3">
                                    <h3 class="subsection-title">Question</h3>
                                    <div class="item-box question-box">{{ question }}</div>
                                </div>
                                
                                <div class="mb-2">
                                    <h3 class="subsection-title">Answer</h3>
                                    <div class="item-box answer-box" style="background-color: #e6ffee;">{{ answer }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Distractor Questions Sections -->
                    {% set distractors = distractors_json|tojson|safe %}
                    <script>
                        var distractorsJson = {{ distractors }};
                    </script>
                    
                    <div id="distractors-container" class="compact-section">
                        <!-- Distractors will be inserted here by JavaScript -->
                    </div>
                    
                    <!-- Bottom submit button -->
                    <div class="d-grid mt-3">
                        <button type="submit" class="btn btn-submit" id="submit-button-bottom" disabled>Submit Report</button>
                    </div>
                </form>
            </div>
        </div>
        
        <footer class="text-center">
            <p>made with ❤️ by <a href="https://github.com/joshua-wilcox">Josh Wilcox</a></p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const distractorsContainer = document.getElementById('distractors-container');
            const distractors = JSON.parse(distractorsJson);
            
            if (distractors && distractors.length > 0) {
                let html = '<h2 class="section-title">Distractors</h2>';
                
                distractors.forEach((distractor, index) => {
                    html += `
                        <div class="qa-section distractor-section">
                            <h3 class="subsection-title">Distractor ${index + 1}</h3>
                            
                            <div class="mb-3">
                                <h4 class="subsection-title">Question</h4>
                                <div class="item-box question-box">${distractor.question}</div>
                            </div>
                            
                            <div class="mb-2">
                                <h4 class="subsection-title">Answer</h4>
                                <div class="item-box answer-box" style="background-color: #fff0f0;">${distractor.answer}</div>
                            </div>
                        </div>
                    `;
                });
                
                distractorsContainer.innerHTML = html;
            } else {
                distractorsContainer.innerHTML = '<p class="text-muted">No distractors associated with this question.</p>';
            }
            
            // Add event listener to message textarea to enable/disable submit buttons
            const messageTextarea = document.getElementById('message');
            const submitButtonTop = document.getElementById('submit-button-top');
            const submitButtonBottom = document.getElementById('submit-button-bottom');
            
            function toggleSubmitButtons() {
                const messageText = messageTextarea.value.trim();
                const isEnabled = messageText.length > 0;
                
                submitButtonTop.disabled = !isEnabled;
                submitButtonBottom.disabled = !isEnabled;
            }
            
            // Listen for input events on the textarea
            messageTextarea.addEventListener('input', toggleSubmitButtons);
            
            // Also validate on form submission
            document.getElementById('report-form').addEventListener('submit', function(e) {
                const messageText = messageTextarea.value.trim();
                if (!messageText) {
                    e.preventDefault();
                    messageTextarea.focus();
                    alert('Please describe the issue before submitting the report.');
                }
            });
        });
    </script>
</body>
</html>
